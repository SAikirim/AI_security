3일차 수업

서브넷팅 : 네트워크를 반복적으로 1/2로 분할해서 구해보자

prefix 표기법

CIDR = 슈퍼넷팅 + 서브넷팅 + prefix

-------------------------------------------------------------

서브넷팅 예제

1. 211.100.10.0 ~ 211.100.10.255의 C클래스 네트워크를 네트워크당 60개의 IP를 사용가능하도록 서브네팅 해보자.

1) 서브넷 마스크는?

/26        255.255.255.192

211.100.10.0/26
211.100.10.64/26
211.100.10.128/26
211.100.10.192/26

2) 서브넷의 개수는? 4개
3) 네트워크당 ip의 개수는? 64, 62
4) 첫번째 서브넷의 브로드캐스트 주소는 어떻게 되는가 ? 211.100.10.63
5) 두번째 서브넷의 사용가능한 ip 범위는 어떻게 되는가?
     211.100.10.65  ~  211.100.10.126

-------------------------------------------------------------------

2. 211.100.10.0 ~ 211.100.10.255의 C클래스 네트워크를 네트워크당 13개의 IP를 사용가능하도록 서브네팅 해보자.

1) 서브넷 마스크는?  255.255.255.240
2) 서브넷의 개수는?  16개
3) 네트워크당 사용가능한 ip의 개수는?   14개
4) 첫번째 서브넷의 브로드캐스트 주소는 어떻게 되는가 ?  211.100.10.15
5) 두번째 서브넷의 사용가능한 ip 범위는 어떻게 되는가?
211.100.10.17  ~   30

3. B클래스 크기의 네트워크를 서브네팅 해보자
네트워크 주소가 151.92.0.0인 B클래스 네트워크를 각 네트워크당 6500개의 ip가 사용 가능하도록 서브네팅 해보자

서브넷마스크는?         255.255.224.0      /19 
서브넷당 사용가능한 ip의 개수는 어떻게 되는가?  8190개
서브넷의 갯수는 어떻게되는가  8개
서브넷의 네트워크 주소를 모두 나열해보자

151.92.0.0/19
151.92.32.0/19
151.92.64.0/19
151.92.96.0/19
.......
/19      ->      8192     255.255.224.0
/20      ->     4096      255.255.240.0
/21    ->        2048      255.255.248.0
/22      ->     1024    255.255.252.0
/23      ->      512     255.255.254.0
/24       ->     254     0 
/25       ->     126   128
/26       ->      62    192
/27      ->       30     224
/28       ->      14     240

-------------------------------------------------------------
VLSM (Variable Length Subnet Mask)

서브넷을 여러번 수행한다.
계산방식 : 가장 큰 네트워크부터 할당
               남은 네트워크를 서브네팅

서브네팅
192.168.100.0 /24 
192.168.100.0    /26   62개    -> 60
192.168.100.64   /26   62개    -> 30
192.168.100.128  /26   62개    -> 10

192.168.100.192  /26

---------------------------------
VLSM
192.168.100.0 /24
192.168.100.0    /26   62개    -> 60
192.168.100.64   /27   30개    -> 30
192.168.100.96  /28    14개    -> 10

192.16.100.112 ~

-----------------------------------------------
문제 1 :
201.102.1.0/24 네트워크를 1팀 120개, 2팀 60개, 3팀, 4팀 각 20개씩 네트워크로
VLSM 서브네팅을 해보시오

각 팀별로 네트워크 주소/prefix 방식으로 표기

1팀 : 201.102.1.0/25
2팀 : 201.102.1.128/26
3팀   201.102.1.192/27
4팀   201.102.1.224 /27


문제 2 : 133.200.0.0/16 네트워크를 다음과 같은 개수로 할당해보시오.

22   25   230  500  1000   2400   3500   4000

---------------------------------------------------------------------
4000           133.200.0.0/20
3500           133.200.16.0/20
2400           133.200.32.0/20
1000           133.200.48.0/22
500             133.200.52.0/23
230             133.200.54.0/24
25               133.200.55.0/27
22              133.200.55.32/27
--------------------------------------------------------------
IP주소 부족을 극복하기 위한 방법

1.IPv6 주소체계 -128 bit 주소 길이를 사용
2. 사설 네트워크 + NAT(Network address Translation)
3. 서브넷 : 네트워크를 쪼개는 기술
4. DHCP : Dynamic Host Configuration Protocol
--------------------------------------------------------------
사설 네트워크 아이피 대역

10.0.0.0  ~  10.255.255.255  사설 네트워크에서 사용(A클래스)
172.16.0.0 ~ 172.31.255.255  사설 네트워크에서 사용(B클래스)
192.168.0.0 ~ 192.168.255.255  사설 네트워크 사용(C클래스)

https://findip.kr/

-----------------------------------------------
퀴즈 
다음중 NAT 기술을 적용하지 않아도 인터넷이 가능한 주소는?

172.15.66.90
10.22.82.10
192.168.3.3
172.31.39.10
--------------------------------------------------

과제) 서브넷팅된 IP주소 구분하기.
보기 IP주소는 서브넷팅된 주소 이다.
 [가] IP주소가 속한 Network Address , 
 [나] IP주소가 속한 Network의 Broadcast Address ,
 [다] 해당 Network의 할당가능한 IP주소 대역 ,
 [라] 보기에 주어진 IP주소가 할당가능한 주소인지 확인하시오
 [마] 만약 할당할 수 없다는 주소라면 그이유를 쓰시오.
       할당할 수 있는 주소인 경우는 '없음' 쓰시오.

예)  130.56.99.120 /30  <- IP address
가. Network Address : 130.56.99.120 /30 
나. Broadcast Address : 130.56.99.123
다. 할당가능한 IP주소대역 : 130.56.99.121~ 130.56.99.122
라. 보기 IP주소는 할당가능한 IP주소예요? -> 할당하지못함.
마. 이유 : Network Address로 예약된 주소이기 때문에.

(1) 10.74.69.52 /29
(2) 85.98.46.119 /25
(3) 96.13.44.146 /30
(4) 75.55.86.210 /26
(5) 129.72.16.116 /28
(6) 222.79.61.159 /27
(7) 192.89.10.255 /23
(8) 156.22.191.0 /22
(9) 225.77.29.42 /21



보기 	

(1) 10.74.69.52 /29
 가_10.74.69.48 /29 
 나_10.74.69.55 /29
 다_10.74.69.49~54 
 라_할당 가능하다.
 마_없음

(2) 85.98.46.119 /25
 가_85.98.46.0 /25
 나_85.98.46.127 /25
 다_85.98.46.1 ~ 126
 라_할당 가능하다
 마_없음

(3) 96.13.44.146 /30
 가_96.12.44.144 /30
 나_96.12.44.147 /30
 다_96.12.44.145 ~ 146
 라_할당 가능
 마_없음


(4) 75.55.86.210 /26
 가_75.55.86.192 /26
 나_75.55.86.255 /26
 다_75.55.86.193 ~ 254
 라_할당 가능
 마_없음

(5) 129.72.16.116 /28         
 가_129.72.16.112 /28
 나_129.72.16.127 /28
 다_129.72.16.113 ~ 126
 라_할당 가능
 마_없음


(6) 222.79.61.159 /27
 가_222.79.61.128 /27
 나_222.79.61.159 /27
 다_222.79.61.129 ~ 158
 라_할당 불가능
 마_브로드캐스트 용도


(7) 192.89.10.255 /23
 가_192.89.10.000 /23
 나_192.89.11.255 /23
 다_192.89.10.001 ~ 192.89.11.254
 라_할당 가능
 마_없음

(8) 156.22.191.0 /22
 가_156.22.188.0 /22
 나_156.22.191.255 /22
 다_156.22.188.001 ~ 156.22.191.254
 라_할당 가능
 마_없음

(9) 225.77.29.42 /21
 가_225.77.24.0 /21
 나_255.77.31.255 /21
 다_255.77.24.001 ~ 255.77.31.254
 다_할당 가능
 마_없음

-------------------------------------------------------------------------

---------------------------------------------------------
프로토콜

준비물 : 와이어샤크 , 프로토콜 이미지

IP 헤더 20 바이트

version : ipv4,ipv6 등 ip 버전 확인용 (4bit)
IHL : IP header length   헤더길이/4 값이 저장
                 일반적으로 5가 저장됨 (4bit)
TOS : Type of Service : 거의 사용되지 않음. QOS와 관련됨
Total Length : IP헤더 길이 + 데이터 길이    2바이트
Identification : 단편화된 조각을 구분하기 위한 구분자
IP FLAGS  : 단편화 옵션
                 D : Do not frag    0이면 단편화된 것  1이면 단편화안된 것
                 M : More frag   0이면 단편화된게 더이상 없다
                                        1이면 단편화된게 더 있다.
Fragment offset : 단편화된 조각 위치

0                         1514       14   20  20
1480                    1514
2960                    154
---------------------------------------------------------------------
TTL : 네트워크에서 패킷의 수명
        라우터를 지날때마다 1 감소
         운영체제별 TTL 값 :  리눅스  64
                                      윈도우   128
                                      네트워크장비(cisco)  255
       (2바이트)
---------------------------------------------
protocol (2바이트)
 01    : ICMP
 06    : TCP
 17     :UDP
------------------------------------------
Header checksum : 헤더에 에러가 있는지 체크

보내는 주소 : 32비트
받는 주소 : 32비트

기타 옵션
IP 전달에 걸린 시간 값, 라우터에 특별한 명령을 내린다...........

--------------------------------------------------------
TCP ,UDP

TCP : 연결지향형 프로토콜
UDP : 비연결지향형 프로토콜

TCP : 안정적인 전송이 목표
UDP : 단순하고 빠른 전송

TCP : 윈도우사이즈 설정을 통해 흐름을 제어
UDP : 흐름 제어 불가

TCP : 긴 데이터 전송에 적합
UDP : 짧은 데이터 전송에 적합

TCP : 대부분의 응용프로그램에서 사용
UDP : DNS, DHCP, SNMP TFTP .....
-----------------------------------------------
TCP 헤더 분석

출발 포트
목적지 포트

Sequence number
Acknowledgment number

seq ack의 통신 방법
1. 보내는 쪽은 임의의 숫자를 지정하여 자신의 seq를 생성
2. 데이터 송신후 자신의 seq값에 보낸 데이터의 양만큼의 숫자를 증가시킴
3. 받는 쪽에서는 전송받은 seq와 데이터 양을 확인하고 ack 값을 계산해서 응답으로 보냄
4. ack는 전송받은 데이터의 양을 표시

3way handshake
1. 클라이언트가 서버에게 연결 시도 : SYN Flag
2. 서버가 클라이언트에게 연결 허용 알림 : SYN+ACK Flag
3. 클라이언트가 수신 확인 전송 : ACK Flag

4way Handshake
1. 연결을 끊고자 하는 쪽에서 연결 종료 시도 : FIN+ACK Flag
2. 상대방에서 연결종료신호 수신 확인 : ACK Flag
3. 상대방도 연결종료 시도 : FIN+ACK Flag
4. 연결을 끊는 쪽에서도 연결종료 수신 확인 : ACK Flag

------------------------------------------------------

Header Length  : 일반적으로 5라는 값이 들어감
                5x4 = 20

TCP Flags

U  : URG  : 긴급한 데이터가 있을 경우 사용
A  : ACK  : 데이터 수신 확인
P  : PSH  : 보내는 데이터를 버퍼에 저장하지 않고 바로 전달
R  : RST : 연결이 비정상일 경우 연결 재수립 요청
S  : SYN : 연결 수립할때
F  : FIN : 연결 종료할때 사용

----------------------------------------

Window size : 호스트가 수신할 수 있는 버퍼 사이즈 
            
흐름제어 : 호스트가 알려주는 버퍼크기에 맞춰 속도 조절

--------------------------------------

checksum : 오류체크 (데이터,헤더)
Urgent Pointer : 긴급한 데이터의 위치를 알려주는 값
                        긴급 데이터의 크기, 끝나는 위치

----------------------------------------

옵션 : 세그먼트 크기, 타임스탬프 값 등등등

--------------------------------------------------------------------
UDP 
출발포트 (2바이트)
목적포트(2바이트)
Length : 전체 길이
             최소값: 8 
checksum : 오류체크 
-------------------------------------------------------------

ARP : IP Address 정보를 가지고 Mac Address 정보를 알아오는 프로토콜


ARP는 어떻게 MAC 주소를 알아오는가?

1. 대상을 찾기 위해 IP 주소에 해당하는 MAC ADDRESS를 ARP로 요청
- 브로드캐스트

2. 해당 ip를 가지고 있는 호스트는 ARP 요청을 전송한 호스트에게 ARP 응답을 전송한다. - 유니캐스트



Hardware Type(2바이트) : 2계층 프로토콜 타입  1(Ethernet)
Protocol type (2바이트): 3계층 프로토콜 타입 0x0800 (ipv4)

Hardware address Length : MAC Address의 길이 : 6
Protocol Address Length : IP Address의 길이 : 4

OPCODE :
1: ARP 요청
2: ARP 응답
3 :RARP 요청
4 :RARP 응답
5 : 다른 종류 ARP 요청/응답

--------------------------------------------------
Sender HardWare Address
Sender Protocol Address
Target HardWare Address
Target Protocol Address

---------------------------------

ARP.PCAP

arp 요청을 하는 호스트의 IP/MAC은?
arp 요청 패킷의 전송 방식 및 목적지는?
arp 프로토콜의 프로토콜 주소/하드웨어 주소의 타입/길이는?
arp 응답을 하는 호스트의 ip? mac?
arp 응답 패킷의 전송 방식 및 목적지는?
arp 요청/응답에 따른 opcode는 ?

-----------------------------------------------------------------
퍼블릭클라우드
aws , gcp  azure       22 ssh

국내 클라우드 : 네이버, 카카오, KT




























